#!/bin/sh
set -eu

#####################################################
# setting
#####################################################

rdir=$(dirname $(cd $(dirname $0); pwd))
tdir=${rdir}/template
ddir=${rdir}/dockerfile

#####################################################
# prepare
#####################################################

mkdir -p "${ddir}"

#####################################################
# fit in Docker Compose
#####################################################

cat "${tdir}/docker-compose.yml"                    |
sed 's!<<ddir>>!'"$(basename ${ddir})"'!'           |
cat > "${rdir}/docker-compose.yml"

#####################################################
# fit in Dockerfile
#####################################################

cat "${tdir}/Dockerfile"                            |
sed 's!<<uid>>!'"$(id -u)"'!'                       |
sed 's!<<gid>>!'"$(id -g)"'!'                       |
cat > "${ddir}/Dockerfile"

#####################################################
# move files
#####################################################

cp ~/.ssh/id_rsa.pub "${ddir}"
